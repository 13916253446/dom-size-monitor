{"version":3,"file":"dom-size-monitor.js","sources":["../src/constant.js","../src/observer/resizeObserver.js","../src/main.js"],"sourcesContent":["//! 要监听的dom属性\nexport const attr = '_dom_size_monitor'\n","\nimport { attr } from '../constant.js'\n//! DOM绑定的事件模型\nlet attrModel = {}\nlet observer = null\n//! 存储callback模型\nlet observe = (element, callback) => {\n  //! 判断是否DOM\n  if (!(element instanceof Element)) {\n    throw new Error('param is not an Element')\n  }\n  //! 创建监听器\n  createObserver()\n  //! 判断该元素是否已经注册过\n  let domAttr = element.getAttribute(attr)\n  let callbacks = attrModel[domAttr]\n  //! 注册过\n  if (domAttr && callbacks && callbacks.length > 0) {\n    if (callbacks.indexOf(callback) < 0) {\n      observer.observe(element)\n      attrModel[domAttr].push(callback)\n    }\n  } else {\n    domAttr = Math.random().toString(16).slice(2)\n    element.setAttribute(attr, domAttr)\n    observer.observe(element)\n    //! 没有注册\n    attrModel[domAttr] = [callback]\n  }\n  //! 绑定之后返回数据\n  return {\n    //! 卸载当前绑定事件\n    unMonitor\n  }\n  //! 卸载当前绑定事件\n  function unMonitor () {\n    let domAttr = element.getAttribute(attr)\n    let callbacks = attrModel[domAttr]\n    if (domAttr && callbacks && callbacks.length > 0) {\n      element.removeAttribute(attr)\n      let index = callbacks.indexOf(callback)\n      callbacks.splice(index, 1)\n    }\n  }\n}\n\n//! 创建observer\nfunction createObserver () {\n  if (observer) return false\n  observer = new ResizeObserver(entries => {\n    entries.forEach(entry => {\n      let { target, contentRect: { width = 0, height = 0 } = {} } = entry\n      let currentAttr = target && target.getAttribute && target.getAttribute(attr)\n      let callbacks = currentAttr && attrModel[currentAttr]\n      if (callbacks) {\n        callbacks.forEach(callback => {\n          let data = { width, height }\n          callback(data)\n        })\n      }\n    })\n  })\n}\n\nexport {\n  observe\n}\n","\nimport { observe as resizeObserver } from './observer/resizeObserver.js'\n//! 监听\nlet monitor = window.ResizeObserver ? resizeObserver : null\n\nexport {\n  monitor\n}\n"],"names":["attr","attrModel","observer","observe","element","callback","Element","Error","createObserver","domAttr","getAttribute","callbacks","length","indexOf","push","Math","random","toString","slice","setAttribute","unMonitor","removeAttribute","index","splice","ResizeObserver","entries","forEach","entry","target","contentRect","width","height","currentAttr","data","monitor","window","resizeObserver"],"mappings":";;;;;;EAAA;AACA,EAAO,MAAMA,OAAO,mBAAb;;ECCP;EACA,IAAIC,YAAY,EAAhB;EACA,IAAIC,WAAW,IAAf;EACA;EACA,IAAIC,UAAU,CAACC,OAAD,EAAUC,QAAV,KAAuB;EACnC;EACA,MAAI,EAAED,mBAAmBE,OAArB,CAAJ,EAAmC;EACjC,UAAM,IAAIC,KAAJ,CAAU,yBAAV,CAAN;EACD;EACD;EACAC;EACA;EACA,MAAIC,UAAUL,QAAQM,YAAR,CAAqBV,IAArB,CAAd;EACA,MAAIW,YAAYV,UAAUQ,OAAV,CAAhB;EACA;EACA,MAAIA,WAAWE,SAAX,IAAwBA,UAAUC,MAAV,GAAmB,CAA/C,EAAkD;EAChD,QAAID,UAAUE,OAAV,CAAkBR,QAAlB,IAA8B,CAAlC,EAAqC;EACnCH,eAASC,OAAT,CAAiBC,OAAjB;EACAH,gBAAUQ,OAAV,EAAmBK,IAAnB,CAAwBT,QAAxB;EACD;EACF,GALD,MAKO;EACLI,cAAUM,KAAKC,MAAL,GAAcC,QAAd,CAAuB,EAAvB,EAA2BC,KAA3B,CAAiC,CAAjC,CAAV;EACAd,YAAQe,YAAR,CAAqBnB,IAArB,EAA2BS,OAA3B;EACAP,aAASC,OAAT,CAAiBC,OAAjB;EACA;EACAH,cAAUQ,OAAV,IAAqB,CAACJ,QAAD,CAArB;EACD;EACD;EACA,SAAO;EACL;EACAe;EAEF;EAJO,GAAP,CAKA,SAASA,SAAT,GAAsB;EACpB,QAAIX,UAAUL,QAAQM,YAAR,CAAqBV,IAArB,CAAd;EACA,QAAIW,YAAYV,UAAUQ,OAAV,CAAhB;EACA,QAAIA,WAAWE,SAAX,IAAwBA,UAAUC,MAAV,GAAmB,CAA/C,EAAkD;EAChDR,cAAQiB,eAAR,CAAwBrB,IAAxB;EACA,UAAIsB,QAAQX,UAAUE,OAAV,CAAkBR,QAAlB,CAAZ;EACAM,gBAAUY,MAAV,CAAiBD,KAAjB,EAAwB,CAAxB;EACD;EACF;EACF,CAtCD;;EAwCA;EACA,SAASd,cAAT,GAA2B;EACzB,MAAIN,QAAJ,EAAc,OAAO,KAAP;EACdA,aAAW,IAAIsB,cAAJ,CAAmBC,WAAW;EACvCA,YAAQC,OAAR,CAAgBC,SAAS;EACvB,UAAI,EAAEC,MAAF,EAAUC,aAAa,EAAEC,QAAQ,CAAV,EAAaC,SAAS,CAAtB,KAA4B,EAAnD,KAA0DJ,KAA9D;EACA,UAAIK,cAAcJ,UAAUA,OAAOlB,YAAjB,IAAiCkB,OAAOlB,YAAP,CAAoBV,IAApB,CAAnD;EACA,UAAIW,YAAYqB,eAAe/B,UAAU+B,WAAV,CAA/B;EACA,UAAIrB,SAAJ,EAAe;EACbA,kBAAUe,OAAV,CAAkBrB,YAAY;EAC5B,cAAI4B,OAAO,EAAEH,KAAF,EAASC,MAAT,EAAX;EACA1B,mBAAS4B,IAAT;EACD,SAHD;EAID;EACF,KAVD;EAWD,GAZU,CAAX;EAaD;;EC5DD;AACA,MAAIC,UAAUC,OAAOX,cAAP,GAAwBY,OAAxB,GAAyC,IAAvD;;;;;;;;;;;;"}